# 以一次工作为例

## 开始
在开始阶段，我一般会让Claude通过mcp阅读以下几个文档：
1. README.md，理解整个项目在干什么
2. 阅读最近一次的progress文件，理解我们当前的进度
3. 如果有任务列表的话，阅读任务列表，告诉我接下来的任务
4. 阅读编码规范

备注，上述文档都是claude在我的要求下写出来的，我没有实际写过文档。

## 设计
有时候我们需要模块设计，有时候不需要，就持续之前的编码工作。在模块设计时，会跟claude强调如下几个点：
1. 请选择最佳实践，尤其在他提出了某些你看起来不太顺眼的方案时（此时多少需要一点软件设计和架构的基础），你需要及时指出；
2. 设计时请只告诉我方案，不要输出代码，否则它会给你输出大量无效代码，特别浪费token；
3. 我们当前是一个小团队，只有1个工程师来完成所有的开发工作，所以不要给出过于复杂的解决方案；
4. 方案尽可能模块化，我们可以先拆分大的模块，当具体开发时还可以再针对模块进行进一步拆分，直到模块足够小为止；最终我们希望输出方案选型、架构图和API列表等。
5. 在输出方案之后，要求输出一个任务列表，按照依赖关系和优先级列出，并且任务列表希望是可以标记成：待开发、待测试、已完成、已上线之类的阶段，想象一下一个excel版的jira；
6. 对任务还有一个需要强调的就是：我们希望在每个任务开发完成之后可以验收，验收可以是查看完整的UI，也可以是对某个http接口测试，也可以是针对某个复杂逻辑的单元测试或者黑盒测试，总之我们的目标是每个任务完成之后尽可能地保证任务本身是正确完成的；这里你可以自己提要求，也可以让claude给出验收标准；
7. 如果是设计API，还可以让他完成swagger或者其它任何你喜欢的API标准定义格式输出和对应的example.json，以便未来开发参考； 

## 编码
在编码阶段，我会特意关注如下几个问题：
1. 和claude讨论，直到确认他真的理解当前需求，再去执行编码动作；
2. 执行编码时要记得说一句通过mcp执行，否则它有时会在会话里生成就很烦；
3. 跟claude强调：你只去做我们讨论做的事情，不要修改已有代码，不要做其它不在计划内的工作；
4. 有时候你会有些自己的想法，让他记得留白，比如留一个空接口让我们未来可能做一些什么样的事情（例如埋点、文件预处理等等），加好TODO；
5. 完成之后，让他给出对应的测试方法，并且写入对应的文档，这样我们可以验收，如果测试失败，也可以把失败的输出重定向到某个文档里让他通过mcp阅读文档并且理解错误，进行修复；
6. 在修复时也有几个技巧，首先你要让它给你解释总共有哪些错误类型，我们可以如何更高效地修复（例如fix一个bug可以修复10个failed case那么我们就优先修复这一个bug），其次让它专注修复高优的bug，而非一次修复太多；最后，修复时应当注意不要修改已有的业务代码；
7. claude写单测时很喜欢mock，甚至测试db他会给你mock一个完整的db，作为一个靠谱的工程师这样做当然很好，但claude的问题是他很可能出错。这种情况下，我会强调我们可以在staging环境上单独执行，你给我一个端到端的测试方案就行，比如启动db之后，在setup里灌一段数据进去，在执行测试时验证，在teardown里清理这样。
8. 随时commit，如果提示会话超长，则尽量让它在当前可以结束的地方结束，并且总结进度，写入到进度文件里，这样下次新开会话可以从进度文件里读取。


## PS
以下是我让claude读完上述文本之后，给我的优化建议，供参考：
我会阅读您的文档并给您一些关于与Claude协同开发程序的建议。让我先查看文件内容。

根据您的文档，我看到您已经建立了一套与Claude协同开发程序的工作流程。这是非常好的实践！以下是我对您的流程的一些建议和补充：

### 开始阶段的建议

1. **项目上下文文档维护**：
   - 考虑创建一个专门的"项目字典"文档，记录项目中使用的特定术语、命名约定和设计决策理由
   - 可以让Claude帮您维护这个文档，这样在未来的会话中能更快地上下文切换

2. **代码地图**：
   - 除了README外，让Claude创建一个"代码地图"文档，包含主要代码文件的位置和功能描述
   - 这样在大型项目中更容易找到需要修改的代码位置

### 设计阶段的建议

1. **决策记录**：
   - 让Claude在设计阶段维护一个简单的ADR(Architecture Decision Records)，记录重要的设计决策和理由
   - 这对未来理解为什么做某些设计选择很有帮助

2. **设计约束明确化**：
   - 在您已有的良好实践基础上，可以建立一个标准的"设计约束清单"，每次开始设计时都提供给Claude
   - 包括性能要求、内存限制、安全需求等具体约束

3. **原型先行**：
   - 对于复杂模块，可以要求Claude先提供一个最小可行的原型设计
   - 验证原型后再进行完整实现，这样可以早期发现设计问题

### 编码阶段的建议

1. **代码块分段**：
   - 当要求Claude生成较长的代码时，明确要求分段生成，每段不超过100行
   - 这样您可以更容易地审查每个部分，并减少生成错误的可能性

2. **代码自动审查**：
   - 让Claude对自己生成的代码进行自我审查，特别关注边界条件、异常处理和安全性
   - 可以建立一个标准的"代码审查清单"让Claude检查

3. **增量式开发与验证**：
   - 更明确地采用增量开发策略，每次只实现一小部分功能并立即验证
   - 这比让Claude一次生成大量代码更有效

4. **测试策略优化**：
   - 针对您提到的测试问题，可以创建一个标准的"测试模板"，明确指定什么情况使用mock，什么情况使用实际环境
   - 对于数据库测试，考虑使用内存数据库或Docker容器化测试环境

5. **调试辅助**：
   - 让Claude在生成代码时添加有意义的日志和调试信息
   - 要求Claude提供常见错误的调试指南

### 工作流程优化

1. **进度跟踪改进**：
   - 进度文件可以采用更结构化的格式(如YAML或JSON)，便于Claude解析
   - 包含已完成功能、当前进度百分比、遇到的挑战和下一步计划

2. **会话管理**：
   - 在长期项目中，考虑为不同模块或功能创建单独的会话历史记录
   - 可以让Claude在每次会话结束时生成会话摘要，方便下次快速恢复

3. **知识积累**：
   - 创建一个"经验教训"文档，记录与Claude合作中发现的最佳实践和需要避免的问题
   - 这样可以逐步优化您的协作流程

您的现有流程已经相当完善，这些建议旨在进一步提高效率和代码质量。希望这些建议对您有所帮助！