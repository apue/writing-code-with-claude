# 系统设计

考虑到我以前用llm编程遇到的一些坑：

- llm喜欢瞎改代码，让他写A功能，顺手就把B改坏了
- llm上下文窗口长度有限1：人可以一次改十几个文件，每个文件改两行，但llm不能
- llm上下文窗口长度有限2：每个会话能写的代码总量有限，不能让一个会话无限长，也就是意味着我们要有能力随时中断会话，并且在下次会话中可以近似无痛地继续。

所以这次开发过程特意针对上面降到的问题进行了一些改进，虽然未必是实际的最佳实践但的确比啥都不做强。

首先，我会让claude帮忙写一份readme，并且写一大堆设计文档，从总体架构到每个开发阶段（比如环境搭建、后端开发、前端开发、整体联调等）可以拆分的步骤和模块等，实际操作可以看一下[后端架构](static/docs/backend_architecture.md)和[前端架构](static/docs/frontend_architecture.md)这两个文档。其实这两个文档过于工程化了，但我觉得问题不大，而且反正实际上最后也不见得按这个来实现。在这些文档之后，我还会把工作逐渐细化，最终细化到每个模块大概的样子，然后会确认在每次开发工作中只完成这个模块，提醒claude，我们尽量不去影响其它模块。

其次，在设计阶段，我还会让claude帮我统一好日志、错误处理等相关规范，这部分会包含文档规范和对应的工具类，后续写代码时，我会让它自己去找app.core.errors和app.infra.logging下面相关的代码来负责处理错误和输出日志，这样就显得稍微不那么业余。

第三，我会让claude注意各种代码格式检查、避免copy & paste等，但看起来效果不佳，这类操作在cursor里通常是通过.cursorrules文件来完成的，但claude desktop似乎没有这方面的机会。

第四，我会在每次开发完成时，让他写下当前的进度和接下来要做的事情，这样下次开发开始就可以让他读readme、架构文档和对应的progress文档，节省我介绍背景信息的时间。“一次开发”可以理解为一个会话。